<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- PWA Basic Meta -->
    <meta name="theme-color" content="#007bff">
    <link rel="manifest" href="manifest.json">
    <title>德德美體美容中心</title>
    <link rel="stylesheet" href="dede.css">
</head>
<body>

<div id="toast-notification" class="toast-notification" role="alert" aria-live="assertive"></div>

<div class="container">
    <h2>德德美體美容中心 <small id="price-version"></small></h2>

    <fieldset>
        <legend>快速操作</legend>
        <div class="header-actions">
             <button id="save-btn" title="儲存當前選擇">💾 儲存</button>
             <button id="load-btn" title="載入上次選擇">📂 讀取</button>
             <button id="clear-btn" title="清除所有選項">🗑️ 清除</button>
             <button id="share-link-btn" title="產生分享網址並複製">🔗 分享</button>
             <button id="screenshot-btn" title="輸出為圖片">📷 截圖</button>
           </div>
    </fieldset>

    <div class="search-container">
        <label for="search-input" class="sr-only">搜尋服務項目</label>
        <input type="search" id="search-input" placeholder="可輸入多個服務名稱，用「,」分隔">
        <div id="search-actions" style="display: none;">
            <button id="select-all-filtered-btn" title="全選目前篩選出的項目">✔️ 全選篩選結果</button>
            <button id="deselect-all-filtered-btn" title="取消全選目前篩選出的項目">❌ 取消全選</button>
        </div>
    </div>

    <fieldset>
        <legend>客戶身分</legend>
        <div class="service-item">
            <input type="checkbox" id="isBirthdayPerson">
            <label for="isBirthdayPerson">當月壽星 (原價 5 折)</label>
        </div>
        <div class="service-item">
            <input type="checkbox" id="isStudent">
            <label for="isStudent">學生 (原價 8 折)</label>
        </div>
    </fieldset>
    
    <div id="service-list">
        <!-- 服務列表將由 JavaScript 動態載入 -->
        <p>正在載入服務項目...</p>
    </div>
</div>

<div id="floating-summary">
    <div id="summary-bar">
        <div id="toggle-details" role="button" tabindex="0" aria-expanded="false" aria-controls="summary-details">
            <span>查看明細</span>
            <span class="arrow" aria-hidden="true">▲</span>
        </div>
        <div class="final-totals">
            <p id="original-total-p" style="display: none;">原始總金額：<span id="floating-original-total">0</span> 元</p>
            <div id="discount-note-container" style="display: none;">
                <span class="discount-note"></span>
            </div>
            <div id="savings-container" style="display: none;">
                <p class="savings-note">共節省：<span id="floating-savings">0</span> 元</p>
            </div>
            <p id="discounted-total-p">總金額：<span id="floating-discounted-total">0</span> 元</p>
            <div id="points-container" style="display: none; color: #007bff; font-weight: bold; margin-top: 8px;">
              <span>🎁 獲得點數：</span>
              <span id="floating-points">0</span>
              <span> 點</span>
            </div>
        </div>
    </div>
    <div id="summary-details" aria-hidden="true">
        <div class="details-content">
            <div class="details-header">
                <h3>消費明細</h3>
            </div>
            <div id="floating-selected-items-list">
                <ul></ul>
            </div>
        </div>
    </div>
</div>

<!-- 引用 html2canvas 函式庫以支援截圖功能 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="app.js"></script>
<script>
    // PWA: 註冊 Service Worker
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./service-worker.js', { scope: './' })
                .then(reg => console.log('ServiceWorker 註冊成功:', reg.scope))
                .catch(err => console.log('ServiceWorker 註冊失敗:', err));
        });
    }
</script>

</body>
</html>
